<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8/>
    <title>Meme</title>


    <!-- ajax -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

    <!-- jquery -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
          integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
            integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
            crossorigin="anonymous"></script>






</head>
<body>
<div class ="container">
<div class="jumbotron">

    <h1>Create !</h1>
    <br>
    <br>

    <input type="file" id="imageLoader" name="imageLoader"/>

    <input type="text" name="Fname" id="words" placeholder="Top Text ">
<button id="entertext">Enter</button>


<canvas id="imageCanvas" width="300" height="300" style="border:3px solid"></canvas>





<input type="text" name="Fname" id="words" placeholder="Bottom Text ">
<button id="entertext">Enter</button>



<br>
<button class="btn btn-default" data-toggle="collapse" data-target="#form1">Upload to Meme Base</button>

<form class="form-inline collapse" id="form1">

	   <div class="form-group">
	    <label class="sr-only" for="memeNameInput">Meme Name</label>
	    <input type="text" class="form-control" id="memeNameInput" placeholder="Enter Meme Name">
	  </div>

	  <div class="form-group">
	    <label class="sr-only" for="memeBaseNameInput">Meme Base Name</label>
	    <input type="text" class="form-control" id="memeBaseNameInput" placeholder="Meme Base Name">
	  </div>


        <button type="submit" class="btn btn-lg btn-default">Upload Meme <span class="glyphicon glyphicon-open"></span></button>
	</form>

	<br>
	<div id="successAlert" class="alert alert-success" role="alert" style="display:none;"></div>
	<div id="errorAlert" class="alert alert-danger" role="alert" style="display:none;"></div>












<a id="download" download="Meme.png">Download as image</a>


    </div>
    </div>


</body>
<script>







    var imageLoader = document.getElementById('imageLoader');
    imageLoader.addEventListener('change', handleImage, false);
    var canvas = document.getElementById('imageCanvas');
    var ctx = canvas.getContext('2d');











    function handleImage(e) {
        var reader = new FileReader();
        reader.onload = function (event) {
            var img = new Image();
            //console.log("var img: " + img);
            img.onload = function () {
                //canvas.width = img.width;
                //canvas.height = img.height;
                ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                //var tf1 = document.getElementsByName('Fname')[0].value

                ctx.font = "20px Georgia";
                //ctx.fillText("Meme Text 1",70,50);
                //ctx.fillText("Meme Text 2", 70, 240);
            }
            img.src = event.target.result;
            //console.log("img src: " + img.src);


        }
        reader.readAsDataURL(e.target.files[0]);


    }







    //http://jsfiddle.net/epistemex/kyjs655r/
    function download() {

        var dt = canvas.toDataURL();
        //console.log("dt:", dt)

         console.log("dt: " + dt)
        this.href = dt;
        //console.log("this.href: " + this.href);
    }
    document.getElementById('download').addEventListener('click', download, false);






$('#form1').on('submit', function(event) {



    //https://davidwalsh.name/convert-image-data-uri-javascript
    var srcdata = canvas.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/, '');


   $.ajax({
      data : {
         memeName : $('#memeNameInput').val(),
         memeBaseName : $('#memeBaseNameInput').val(),
         data : srcdata

      },
      type : 'POST',
      url : '/process'
   })
   .done(function(data) {

      if (data.error) {
         $('#errorAlert').text(data.error).show();
         $('#successAlert').hide();
      }
      else {
         $('#successAlert').text(data.name).show();
         $('#errorAlert').hide();
      }

   });

   event.preventDefault();

});









    $('#entertext').click(function () {
        ctx.fillText($("#words").val(), 70, 50);
    });


</script>

</html>